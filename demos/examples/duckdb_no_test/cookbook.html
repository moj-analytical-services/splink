
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://moj-analytical-services.github.io/splink/demos/examples/duckdb_no_test/cookbook.html">
      
      
        <link rel="prev" href="../duckdb/febrl4.html">
      
      
        <link rel="next" href="bias_eval.html">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.2">
    
    
      
        <title>Cookbook - Splink</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
      <link rel="stylesheet" href="../../../css/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-L6JT8NK528"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-L6JT8NK528",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-L6JT8NK528",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cookbook" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            

    <center> Still using Splink 3 and looking for the old docs?  You can find them  <a href ="https://moj-analytical-services.github.io/splink3_legacy_docs/index.html">here</a></center>


          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Splink" class="md-header__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../../../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Splink
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cookbook
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../getting_started.html" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/00_Tutorial_Introduction.html" class="md-tabs__link">
          
  
    
  
  Tutorial

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../examples_index.html" class="md-tabs__link">
          
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../api_docs/api_docs_index.html" class="md-tabs__link">
          
  
    
  
  API Docs

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../topic_guides/topic_guides_index.html" class="md-tabs__link">
          
  
    
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../dev_guides/index.html" class="md-tabs__link">
          
  
    
  
  Contributing

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/index.html" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Splink" class="md-nav__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../../../img/favicon.ico" alt="logo">

    </a>
    Splink
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/00_Tutorial_Introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/01_Prerequisites.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Data prep prerequisites
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/02_Exploratory_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Exploratory analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/03_Blocking.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Blocking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/04_Estimating_model_parameters.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Estimating model parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/05_Predicting_results.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Predicting results
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/06_Visualising_predictions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Visualising predictions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/07_Evaluation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Evaluation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/08_building_your_own_model.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Tips for building your own model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples_index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DuckDB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            DuckDB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/deduplicate_50k_synthetic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deduplicate 50k rows historical persons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/transactions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linking financial transactions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="business_rates_match.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linking businesses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/link_only.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linking two tables of persons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/real_time_record_linkage.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Real time record linkage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/accuracy_analysis_from_labels_column.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluation from ground truth column
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/pairwise_labels.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Estimating m probabilities from labels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/quick_and_dirty_persons.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick and dirty persons model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/deterministic_dedupe.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deterministic dedupe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/febrl3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Febrl3 Dedupe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../duckdb/febrl4.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Febrl4 link-only
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Cookbook
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="cookbook.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Cookbook
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#array-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Array columns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Array columns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comparing-array-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Comparing array columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blocking-on-array-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Blocking on array columns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" class="md-nav__link">
    <span class="md-ellipsis">
      Other
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-duckdb-without-pandas" class="md-nav__link">
    <span class="md-ellipsis">
      Using DuckDB without pandas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixing-m-or-u-probabilities-during-training" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing m or u probabilities during training
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manually-altering-m-and-u-probabilities-post-training" class="md-nav__link">
    <span class="md-ellipsis">
      Manually altering m and u probabilities post-training
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-the-beta-labelling-tool" class="md-nav__link">
    <span class="md-ellipsis">
      Generate the (beta) labelling tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-settings-after-loading-from-a-serialised-json-model" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying settings after loading from a serialised .json model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-duckdb-udf-in-a-comparison-level" class="md-nav__link">
    <span class="md-ellipsis">
      Using a DuckDB UDF in a comparison level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-linkage" class="md-nav__link">
    <span class="md-ellipsis">
      Nested linkage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparing-a-list-of-values-with-fuzzy-matching-and-term-frequency-adjustments" class="md-nav__link">
    <span class="md-ellipsis">
      Comparing a list of values with fuzzy matching and term frequency adjustments
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="bias_eval.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Investigating Bias in a Splink Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="comparison_playground.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Comparison playground
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pseudopeople-acs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pseudopeople Census to ACS link
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PySpark
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            PySpark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/deduplicate_1k_synthetic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deduplication using Pyspark
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Athena
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Athena
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../athena/deduplicate_50k_synthetic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deduplicate 50k rows historical persons
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SQLite
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            SQLite
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sqlite/deduplicate_50k_synthetic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deduplicate 50k rows historical persons
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Docs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/api_docs_index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linker
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Linker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/training.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/visualisations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualisations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/inference.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/linker_clustering.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/evaluation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/table_management.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Table Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/misc.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Miscellaneous functions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Comparisons Library
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Comparisons Library
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/comparison_library.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Comparison Library
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/comparison_level_library.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Comparison Level Library
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Other
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Other
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/exploratory.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exploratory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/blocking_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blocking analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/blocking.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blocking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/clustering.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clustering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/splink_dataframe.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SplinkDataFrame
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/em_training_session.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EM Training Session API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/column_expression.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Column Expressions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    In-build datasets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            In-build datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/datasets.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SplinkDatasets
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Splink Settings
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Splink Settings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api_docs/settings_dict_guide.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Settings Dict
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/topic_guides_index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Record Linkage Theory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Record Linkage Theory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/theory/record_linkage.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Why do we need record linkage?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/theory/probabilistic_vs_deterministic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Probabilistic vs Deterministic linkage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/theory/fellegi_sunter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Fellegi-Sunter Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/theory/linked_data_as_graphs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linked Data as Graphs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linkage Models in Splink
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Linkage Models in Splink
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/splink_fundamentals/settings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Defining Splink models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/splink_fundamentals/querying_splink_results.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retrieving and querying Splink results
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/splink_fundamentals/link_type.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Link type - linking vs deduping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3_4" >
        
          
          <label class="md-nav__link" for="__nav_5_3_4" id="__nav_5_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Splink's SQL backends - Spark, DuckDB etc
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3_4">
            <span class="md-nav__icon md-icon"></span>
            Splink's SQL backends - Spark, DuckDB etc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/splink_fundamentals/backends/backends.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backends overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/splink_fundamentals/backends/postgres.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PostgreSQL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Preparation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Data Preparation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/data_preparation/feature_engineering.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Engineering
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blocking
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Blocking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/blocking/blocking_rules.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What are Blocking Rules?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/blocking/performance.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computational Performance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/blocking/model_training.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model Training Blocking Rules
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Comparing Records
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Comparing Records
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/comparisons_and_comparison_levels.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Comparisons and comparison levels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/customising_comparisons.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Defining and customising comparisons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/out_of_the_box_comparisons.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Out-of-the-box comparisons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/term-frequency.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Term frequency adjustments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6_5" >
        
          
          <label class="md-nav__link" for="__nav_5_6_5" id="__nav_5_6_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Comparing strings
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_5">
            <span class="md-nav__icon md-icon"></span>
            Comparing strings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/comparators.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    String comparators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/choosing_comparators.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Choosing string comparators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/phonetic.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phonetic algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/regular_expressions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regular expressions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Training
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/training/training_rationale.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training rationale
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Evaluation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Evaluation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/evaluation/overview.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/evaluation/model.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8_3" >
        
          
          <label class="md-nav__link" for="__nav_5_8_3" id="__nav_5_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Edges (Links)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8_3">
            <span class="md-nav__icon md-icon"></span>
            Edges (Links)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/evaluation/edge_overview.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/evaluation/edge_metrics.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Edge Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/evaluation/labelling.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clerical Labelling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8_4" >
        
          
          <label class="md-nav__link" for="__nav_5_8_4" id="__nav_5_8_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Clusters
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8_4">
            <span class="md-nav__icon md-icon"></span>
            Clusters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/evaluation/clusters/overview.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/evaluation/clusters/graph_metrics.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graph metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/evaluation/clusters/how_to_compute_metrics.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to compute graph metrics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_9" >
        
          
          <label class="md-nav__link" for="__nav_5_9" id="__nav_5_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Performance
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_9">
            <span class="md-nav__icon md-icon"></span>
            Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/performance/drivers_of_performance.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run times, performance and linking large data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/performance/performance_of_comparison_functions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Performance of comparison functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_9_3" >
        
          
          <label class="md-nav__link" for="__nav_5_9_3" id="__nav_5_9_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spark Performance
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_9_3">
            <span class="md-nav__icon md-icon"></span>
            Spark Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/performance/optimising_spark.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimising Spark performance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/performance/salting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Salting blocking rules
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_9_4" >
        
          
          <label class="md-nav__link" for="__nav_5_9_4" id="__nav_5_9_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DuckDB Performance
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_9_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_9_4">
            <span class="md-nav__icon md-icon"></span>
            DuckDB Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/performance/optimising_duckdb.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimising DuckDB performance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../charts/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Charts Gallery
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            Charts Gallery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10_2" >
        
          
          <label class="md-nav__link" for="__nav_5_10_2" id="__nav_5_10_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Exploratory Analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_10_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10_2">
            <span class="md-nav__icon md-icon"></span>
            Exploratory Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/completeness_chart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    completeness chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/profile_columns.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    profile columns
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10_3" >
        
          
          <label class="md-nav__link" for="__nav_5_10_3" id="__nav_5_10_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blocking
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_10_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10_3">
            <span class="md-nav__icon md-icon"></span>
            Blocking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/cumulative_comparisons_to_be_scored_from_blocking_rules_chart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cumulative num comparisons from blocking rules chart
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10_4" >
        
          
          <label class="md-nav__link" for="__nav_5_10_4" id="__nav_5_10_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Similarity analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10_4">
            <span class="md-nav__icon md-icon"></span>
            Similarity analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/choosing_comparators.html#comparing-string-similarity-and-distance-scores" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Comparator score chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/choosing_comparators.html#choosing-thresholds" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Comparator score threshold chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/comparisons/choosing_comparators.html#phonetic-matching" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phonetic match chart
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10_5" >
        
          
          <label class="md-nav__link" for="__nav_5_10_5" id="__nav_5_10_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Training
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_10_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10_5">
            <span class="md-nav__icon md-icon"></span>
            Model Training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/comparison_viewer_dashboard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    comparison viewer dashboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/match_weights_chart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    match weights chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/m_u_parameters_chart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    m u parameters chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/parameter_estimate_comparisons_chart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    parameter estimate comparisons chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/tf_adjustment_chart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tf adjustment chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/unlinkables_chart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    unlinkables chart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/waterfall_chart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    waterfall chart
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10_6" >
        
          
          <label class="md-nav__link" for="__nav_5_10_6" id="__nav_5_10_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Clustering
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_10_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10_6">
            <span class="md-nav__icon md-icon"></span>
            Clustering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/cluster_studio_dashboard.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cluster studio dashboard
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10_7" >
        
          
          <label class="md-nav__link" for="__nav_5_10_7" id="__nav_5_10_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Evaluation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_10_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10_7">
            <span class="md-nav__icon md-icon"></span>
            Model Evaluation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/accuracy_analysis_from_labels_table.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    accuracy chart from labels table
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../charts/threshold_selection_tool_from_labels_table.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    threshold selection tool
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topic_guides/llms/prompting_llms.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LLM prompts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../dev_guides/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing to Splink
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Contributing to Splink
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/CONTRIBUTING.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributor Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/changing_splink/development_quickstart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Quickstart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/changing_splink/lint_and_format.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linting and Formatting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/changing_splink/testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/changing_splink/contributing_to_docs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing to Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/changing_splink/managing_dependencies_with_uv.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Managing Environment and Dependencies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/changing_splink/releases.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Releasing a Package Version
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/changing_splink/blog_posts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing to the Splink Blog
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    How Splink works
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            How Splink works
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/debug_modes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding and debugging Splink
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/transpilation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transpilation using sqlglot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3_3" id="__nav_6_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Performance and caching
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_3">
            <span class="md-nav__icon md-icon"></span>
            Performance and caching
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/caching.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Caching and pipelining
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/spark_pipelining_and_caching.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spark caching
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_4" >
        
          
          <label class="md-nav__link" for="__nav_6_3_4" id="__nav_6_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Charts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_4">
            <span class="md-nav__icon md-icon"></span>
            Charts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/charts/understanding_and_editing_charts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding and editing charts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/charts/building_charts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building new charts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/udfs.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User-Defined Functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/dependency_compatibility_policy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dependency Compatibility Policy
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../blog/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/bias.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bias
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/ethics.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ethics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../blog/category/feature-updates.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feature Updates
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#array-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Array columns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Array columns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comparing-array-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Comparing array columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blocking-on-array-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Blocking on array columns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" class="md-nav__link">
    <span class="md-ellipsis">
      Other
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-duckdb-without-pandas" class="md-nav__link">
    <span class="md-ellipsis">
      Using DuckDB without pandas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixing-m-or-u-probabilities-during-training" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing m or u probabilities during training
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manually-altering-m-and-u-probabilities-post-training" class="md-nav__link">
    <span class="md-ellipsis">
      Manually altering m and u probabilities post-training
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-the-beta-labelling-tool" class="md-nav__link">
    <span class="md-ellipsis">
      Generate the (beta) labelling tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-settings-after-loading-from-a-serialised-json-model" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying settings after loading from a serialised .json model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-a-duckdb-udf-in-a-comparison-level" class="md-nav__link">
    <span class="md-ellipsis">
      Using a DuckDB UDF in a comparison level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-linkage" class="md-nav__link">
    <span class="md-ellipsis">
      Nested linkage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparing-a-list-of-values-with-fuzzy-matching-and-term-frequency-adjustments" class="md-nav__link">
    <span class="md-ellipsis">
      Comparing a list of values with fuzzy matching and term frequency adjustments
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/moj-analytical-services/splink/edit/master/docs/demos/examples/duckdb_no_test/cookbook.ipynb" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<div><h1 id="cookbook">Cookbook<a class="headerlink" href="#cookbook" title="Permanent link">¶</a></h1>
<p>This notebook contains a miscellaneous collection of runnable examples illustrating various Splink techniques.</p>
<h2 id="array-columns">Array columns<a class="headerlink" href="#array-columns" title="Permanent link">¶</a></h2>
<h3 id="comparing-array-columns">Comparing array columns<a class="headerlink" href="#comparing-array-columns" title="Permanent link">¶</a></h3>
<p>This example shows how we can use use <code>ArrayIntersectAtSizes</code> to assess the similarity of columns containing arrays.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span><span class="p">,</span> <span class="n">block_on</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="s2">"postcode"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">]},</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="s2">"postcode"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"B"</span><span class="p">]},</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="s2">"postcode"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"A"</span><span class="p">]},</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="s2">"postcode"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">]},</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="s2">"postcode"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"C"</span><span class="p">]},</span>
<span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ArrayIntersectAtSizes</span><span class="p">(</span><span class="s2">"postcode"</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>


<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">DuckDBAPI</span><span class="p">(),</span> <span class="n">set_up_basic_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span><span class="o">.</span><span class="n">as_pandas_dataframe</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_weight</th>
      <th>match_probability</th>
      <th>unique_id_l</th>
      <th>unique_id_r</th>
      <th>postcode_l</th>
      <th>postcode_r</th>
      <th>gamma_postcode</th>
      <th>first_name_l</th>
      <th>first_name_r</th>
      <th>gamma_first_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-8.287568</td>
      <td>0.003190</td>
      <td>4</td>
      <td>5</td>
      <td>[A, B]</td>
      <td>[C]</td>
      <td>0</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.287568</td>
      <td>0.450333</td>
      <td>3</td>
      <td>4</td>
      <td>[A]</td>
      <td>[A, B]</td>
      <td>1</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-8.287568</td>
      <td>0.003190</td>
      <td>3</td>
      <td>5</td>
      <td>[A]</td>
      <td>[C]</td>
      <td>0</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-8.287568</td>
      <td>0.003190</td>
      <td>2</td>
      <td>3</td>
      <td>[B]</td>
      <td>[A]</td>
      <td>0</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.287568</td>
      <td>0.450333</td>
      <td>2</td>
      <td>4</td>
      <td>[B]</td>
      <td>[A, B]</td>
      <td>1</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-8.287568</td>
      <td>0.003190</td>
      <td>2</td>
      <td>5</td>
      <td>[B]</td>
      <td>[C]</td>
      <td>0</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.287568</td>
      <td>0.450333</td>
      <td>1</td>
      <td>2</td>
      <td>[A, B]</td>
      <td>[B]</td>
      <td>1</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.287568</td>
      <td>0.450333</td>
      <td>1</td>
      <td>3</td>
      <td>[A, B]</td>
      <td>[A]</td>
      <td>1</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>6.712432</td>
      <td>0.990554</td>
      <td>1</td>
      <td>4</td>
      <td>[A, B]</td>
      <td>[A, B]</td>
      <td>2</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-8.287568</td>
      <td>0.003190</td>
      <td>1</td>
      <td>5</td>
      <td>[A, B]</td>
      <td>[C]</td>
      <td>0</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="blocking-on-array-columns">Blocking on array columns<a class="headerlink" href="#blocking-on-array-columns" title="Permanent link">¶</a></h3>
<p>This example shows how we can use <code>block_on</code> to block on the individual elements of an array column - that is, pairwise comaprisons are created for pairs or records where any of the elements in the array columns match.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span><span class="p">,</span> <span class="n">block_on</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="s2">"postcode"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">]},</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="s2">"postcode"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"B"</span><span class="p">]},</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">"first_name"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="s2">"postcode"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"C"</span><span class="p">]},</span>

<span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"postcode"</span><span class="p">,</span> <span class="n">arrays_to_explode</span><span class="o">=</span><span class="p">[</span><span class="s2">"postcode"</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ArrayIntersectAtSizes</span><span class="p">(</span><span class="s2">"postcode"</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>


<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">DuckDBAPI</span><span class="p">(),</span> <span class="n">set_up_basic_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span><span class="o">.</span><span class="n">as_pandas_dataframe</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_weight</th>
      <th>match_probability</th>
      <th>unique_id_l</th>
      <th>unique_id_r</th>
      <th>postcode_l</th>
      <th>postcode_r</th>
      <th>gamma_postcode</th>
      <th>first_name_l</th>
      <th>first_name_r</th>
      <th>gamma_first_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.287568</td>
      <td>0.450333</td>
      <td>1</td>
      <td>2</td>
      <td>[A, B]</td>
      <td>[B]</td>
      <td>1</td>
      <td>John</td>
      <td>John</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="other">Other<a class="headerlink" href="#other" title="Permanent link">¶</a></h2>
<h3 id="using-duckdb-without-pandas">Using DuckDB without pandas<a class="headerlink" href="#using-duckdb-without-pandas" title="Permanent link">¶</a></h3>
<p>In this example, we read data directly using DuckDB and obtain results in native DuckDB <code>DuckDBPyRelation</code> format.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">duckdb</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span><span class="p">,</span> <span class="n">block_on</span><span class="p">,</span> <span class="n">splink_datasets</span>

<span class="c1"># Create a parquet file on disk to demontrate native DuckDB parquet reading</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">splink_datasets</span><span class="o">.</span><span class="n">fake_1000</span>
<span class="n">temp_file</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">".parquet"</span><span class="p">)</span>
<span class="n">temp_file_path</span> <span class="o">=</span> <span class="n">temp_file</span><span class="o">.</span><span class="n">name</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">)</span>

<span class="c1"># Example would start here if you already had a parquet file</span>
<span class="n">duckdb_df</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">)</span>

<span class="n">db_api</span> <span class="o">=</span> <span class="n">DuckDBAPI</span><span class="p">(</span><span class="s2">":default:"</span><span class="p">)</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">NameComparison</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">JaroAtThresholds</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">,</span> <span class="s2">"dob"</span><span class="p">),</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">db_api</span><span class="p">,</span> <span class="n">set_up_basic_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span><span class="o">.</span><span class="n">as_duckdbpyrelation</span><span class="p">()</span>

<span class="c1"># Since result is a DuckDBPyRelation, we can use all the usual DuckDB API</span>
<span class="c1"># functions on it.</span>

<span class="c1"># For example, we can use the `sort` function to sort the results,</span>
<span class="c1"># or could use result.to_parquet() to write to a parquet file.</span>
<span class="n">result</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">"match_weight"</span><span class="p">)</span>
</code></pre></div>
<pre><code>┌─────────────────────┬──────────────────────┬─────────────┬───┬───────────────┬────────────┬────────────┬───────────┐
│    match_weight     │  match_probability   │ unique_id_l │ … │ gamma_surname │   dob_l    │   dob_r    │ match_key │
│       double        │        double        │    int64    │   │     int32     │  varchar   │  varchar   │  varchar  │
├─────────────────────┼──────────────────────┼─────────────┼───┼───────────────┼────────────┼────────────┼───────────┤
│  -11.83278901894715 │ 0.000274066864295451 │         758 │ … │             0 │ 2002-09-15 │ 2002-09-15 │ 0         │
│ -10.247826518225994 │  0.0008217501639050… │         670 │ … │             0 │ 2006-12-05 │ 2006-12-05 │ 0         │
│  -9.662864017504837 │  0.0012321189988629… │         558 │ … │             0 │ 2020-02-11 │ 2020-02-11 │ 0         │
│  -9.470218939562441 │  0.0014078881864458… │         259 │ … │             1 │ 1983-03-07 │ 1983-03-07 │ 0         │
│  -8.470218939562441 │ 0.002811817648042493 │         644 │ … │            -1 │ 1992-02-06 │ 1992-02-06 │ 0         │
│  -8.287568102831404 │  0.0031901106569634… │         393 │ … │             3 │ 1991-05-06 │ 1991-04-12 │ 1         │
│  -8.287568102831404 │  0.0031901106569634… │         282 │ … │             3 │ 2004-12-02 │ 2002-02-25 │ 1         │
│  -8.287568102831404 │  0.0031901106569634… │         282 │ … │             3 │ 2004-12-02 │ 1993-03-01 │ 1         │
│  -8.287568102831404 │  0.0031901106569634… │         531 │ … │             3 │ 1987-09-11 │ 2000-09-03 │ 1         │
│  -8.287568102831404 │  0.0031901106569634… │         531 │ … │             3 │ 1987-09-11 │ 1990-10-06 │ 1         │
│           ·         │            ·         │          ·  │ · │             · │     ·      │     ·      │ ·         │
│           ·         │            ·         │          ·  │ · │             · │     ·      │     ·      │ ·         │
│           ·         │            ·         │          ·  │ · │             · │     ·      │     ·      │ ·         │
│   5.337135982495163 │   0.9758593366351407 │         554 │ … │             3 │ 2020-02-11 │ 2030-02-08 │ 1         │
│   5.337135982495163 │   0.9758593366351407 │         774 │ … │             3 │ 2027-04-21 │ 2017-04-23 │ 1         │
│   5.337135982495163 │   0.9758593366351407 │         874 │ … │             3 │ 2020-06-23 │ 2019-05-23 │ 1         │
│   5.337135982495163 │   0.9758593366351407 │         409 │ … │             3 │ 2017-05-03 │ 2008-05-05 │ 1         │
│   5.337135982495163 │   0.9758593366351407 │         415 │ … │             3 │ 2002-02-25 │ 1993-03-01 │ 1         │
│   5.337135982495163 │   0.9758593366351407 │         740 │ … │             3 │ 2005-09-18 │ 2006-09-14 │ 1         │
│   5.337135982495163 │   0.9758593366351407 │         417 │ … │             3 │ 2002-02-24 │ 1992-02-28 │ 1         │
│   5.337135982495163 │   0.9758593366351407 │         534 │ … │             3 │ 1974-02-28 │ 1975-03-31 │ 1         │
│   5.337135982495163 │   0.9758593366351407 │         286 │ … │             3 │ 1985-01-05 │ 1986-02-04 │ 1         │
│   5.337135982495163 │   0.9758593366351407 │         172 │ … │             3 │ 2012-07-06 │ 2012-07-09 │ 1         │
├─────────────────────┴──────────────────────┴─────────────┴───┴───────────────┴────────────┴────────────┴───────────┤
│ 1800 rows (20 shown)                                                                          13 columns (7 shown) │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 id="fixing-m-or-u-probabilities-during-training">Fixing <code>m</code> or <code>u</code> probabilities during training<a class="headerlink" href="#fixing-m-or-u-probabilities-during-training" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_level_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cll</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span><span class="p">,</span> <span class="n">block_on</span><span class="p">,</span> <span class="n">splink_datasets</span>


<span class="n">db_api</span> <span class="o">=</span> <span class="n">DuckDBAPI</span><span class="p">()</span>

<span class="n">first_name_comparison</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">CustomComparison</span><span class="p">(</span>
    <span class="n">comparison_levels</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">NullLevel</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">ExactMatchLevel</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
            <span class="n">m_probability</span><span class="o">=</span><span class="mf">0.9999</span><span class="p">,</span>
            <span class="n">fix_m_probability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">u_probability</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">fix_u_probability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">ElseLevel</span><span class="p">(),</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">first_name_comparison</span><span class="p">,</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"city"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">additional_columns_to_retain</span><span class="o">=</span><span class="p">[</span><span class="s2">"cluster"</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">splink_datasets</span><span class="o">.</span><span class="n">fake_1000</span>
<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">db_api</span><span class="p">,</span> <span class="n">set_up_basic_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_u_using_random_sampling</span><span class="p">(</span><span class="n">max_pairs</span><span class="o">=</span><span class="mf">1e6</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span><span class="n">block_on</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">))</span>

<span class="n">linker</span><span class="o">.</span><span class="n">visualisations</span><span class="o">.</span><span class="n">m_u_parameters_chart</span><span class="p">()</span>
</code></pre></div>
<style>
  #altair-viz-e9bf017f37784baeac18f1a32e54540e.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-e9bf017f37784baeac18f1a32e54540e.vega-embed details,
  #altair-viz-e9bf017f37784baeac18f1a32e54540e.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-e9bf017f37784baeac18f1a32e54540e"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-e9bf017f37784baeac18f1a32e54540e") {
      outputDiv = document.getElementById("altair-viz-e9bf017f37784baeac18f1a32e54540e");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300, "discreteHeight": 300, "discreteWidth": 400}, "header": {"title": null}, "title": {"anchor": "middle", "offset": 10}}, "hconcat": [{"mark": "bar", "encoding": {"color": {"value": "green"}, "row": {"field": "comparison_name", "header": {"labelAlign": "left", "labelAnchor": "middle", "labelAngle": 0}, "sort": {"field": "comparison_sort_order"}, "type": "nominal"}, "tooltip": [{"field": "m_probability_description", "title": "m probability description", "type": "nominal"}, {"field": "comparison_name", "title": "Comparison column name", "type": "nominal"}, {"field": "label_for_charts", "title": "Label", "type": "ordinal"}, {"field": "sql_condition", "title": "SQL condition", "type": "nominal"}, {"field": "m_probability", "format": ".4p", "title": "m probability", "type": "quantitative"}, {"field": "u_probability", "format": ".4p", "title": "u probability", "type": "quantitative"}, {"field": "bayes_factor", "format": ",.4f", "title": "Bayes factor = m/u", "type": "quantitative"}, {"field": "log2_bayes_factor", "format": ",.4f", "title": "Match weight = log2(m/u)", "type": "quantitative"}], "x": {"axis": {"title": "Proportion of record comparisons"}, "field": "m_probability", "type": "quantitative"}, "y": {"axis": {"title": null}, "field": "label_for_charts", "sort": {"field": "comparison_vector_value", "order": "descending"}, "type": "nominal"}}, "height": {"step": 12}, "resolve": {"scale": {"y": "independent"}}, "title": {"text": "Amongst matching record comparisons:", "fontSize": 12, "fontWeight": "bold"}, "transform": [{"filter": "(datum.bayes_factor != 'no-op filter due to vega lite issue 4680')"}], "width": 150}, {"mark": "bar", "encoding": {"color": {"value": "red"}, "row": {"field": "comparison_name", "header": {"labels": false}, "sort": {"field": "comparison_sort_order"}, "type": "nominal"}, "tooltip": [{"field": "u_probability_description", "title": "u probability description", "type": "nominal"}, {"field": "comparison_name", "title": "Comparison column name", "type": "nominal"}, {"field": "label_for_charts", "title": "Label", "type": "ordinal"}, {"field": "sql_condition", "title": "SQL condition", "type": "nominal"}, {"field": "m_probability", "format": ".4p", "title": "m probability", "type": "quantitative"}, {"field": "u_probability", "format": ".4p", "title": "u probability", "type": "quantitative"}, {"field": "bayes_factor", "format": ",.4f", "title": "Bayes factor = m/u", "type": "quantitative"}, {"field": "log2_bayes_factor", "format": ",.4f", "title": "Match weight = log2(m/u)", "type": "quantitative"}], "x": {"axis": {"title": "Proportion of record comparisons"}, "field": "u_probability", "type": "quantitative"}, "y": {"axis": {"title": null}, "field": "label_for_charts", "sort": {"field": "comparison_vector_value", "order": "descending"}, "type": "nominal"}}, "height": {"step": 12}, "resolve": {"scale": {"y": "independent"}}, "title": {"text": "Amongst non-matching record comparisons:", "fontSize": 12, "fontWeight": "bold"}, "transform": [{"filter": "(datum.bayes_factor != 'no-op filter2 due to vega lite issue 4680')"}], "width": 150}], "data": {"name": "data-9d9c6a8e8f240fded6a564163503625b"}, "title": {"text": "Proportion of record comparisons in each comparison level by match status", "subtitle": "(m and u probabilities)"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.9.3.json", "datasets": {"data-9d9c6a8e8f240fded6a564163503625b": [{"comparison_name": "first_name", "sql_condition": "\"first_name_l\" = \"first_name_r\"", "label_for_charts": "Exact match on first_name", "m_probability": 0.9999, "u_probability": 0.7, "m_probability_description": "Amongst matching record comparisons, 99.99% of records are in the exact match on first_name comparison level", "u_probability_description": "Amongst non-matching record comparisons, 70.00% of records are in the exact match on first_name comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 1.4284285714285716, "log2_bayes_factor": 0.5144288961117134, "comparison_vector_value": 1, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `exact match on first_name` then comparison is 1.43 times more likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 0}, {"comparison_name": "first_name", "sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.4600175745072434, "u_probability": 0.9942064286024966, "m_probability_description": "Amongst matching record comparisons, 46.00% of records are in the all other comparisons comparison level", "u_probability_description": "Amongst non-matching record comparisons, 99.42% of records are in the all other comparisons comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 0.4626982498532682, "log2_bayes_factor": -1.1118564529385215, "comparison_vector_value": 0, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `all other comparisons` then comparison is  2.16 times less likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 0}, {"comparison_name": "surname", "sql_condition": "\"surname_l\" = \"surname_r\"", "label_for_charts": "Exact match on surname", "m_probability": 0.5352088162411789, "u_probability": 0.004889975550122249, "m_probability_description": "Amongst matching record comparisons, 53.52% of records are in the exact match on surname comparison level", "u_probability_description": "Amongst non-matching record comparisons, 0.49% of records are in the exact match on surname comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 109.45020292132108, "log2_bayes_factor": 6.7741308190611695, "comparison_vector_value": 1, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `exact match on surname` then comparison is 109.45 times more likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 1}, {"comparison_name": "surname", "sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.46479118375882117, "u_probability": 0.9951100244498777, "m_probability_description": "Amongst matching record comparisons, 46.48% of records are in the all other comparisons comparison level", "u_probability_description": "Amongst non-matching record comparisons, 99.51% of records are in the all other comparisons comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 0.4670751699197982, "log2_bayes_factor": -1.0982733425039641, "comparison_vector_value": 0, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `all other comparisons` then comparison is  2.14 times less likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 1}, {"comparison_name": "dob", "sql_condition": "\"dob_l\" = \"dob_r\"", "label_for_charts": "Exact match on dob", "m_probability": 0.95, "u_probability": 0.0017477477477477479, "m_probability_description": "Amongst matching record comparisons, 95.00% of records are in the exact match on dob comparison level", "u_probability_description": "Amongst non-matching record comparisons, 0.17% of records are in the exact match on dob comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 543.5567010309278, "log2_bayes_factor": 9.086286727381289, "comparison_vector_value": 1, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `exact match on dob` then comparison is 543.56 times more likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 2}, {"comparison_name": "dob", "sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.050000000000000044, "u_probability": 0.9982522522522522, "m_probability_description": "Amongst matching record comparisons, 5.00% of records are in the all other comparisons comparison level", "u_probability_description": "Amongst non-matching record comparisons, 99.83% of records are in the all other comparisons comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 0.05008754038589973, "log2_bayes_factor": -4.319404421864071, "comparison_vector_value": 0, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `all other comparisons` then comparison is  19.97 times less likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 2}, {"comparison_name": "city", "sql_condition": "\"city_l\" = \"city_r\"", "label_for_charts": "Exact match on city", "m_probability": 0.6694809875123263, "u_probability": 0.0551475711801453, "m_probability_description": "Amongst matching record comparisons, 66.95% of records are in the exact match on city comparison level", "u_probability_description": "Amongst non-matching record comparisons, 5.51% of records are in the exact match on city comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 12.139809119161328, "log2_bayes_factor": 3.601673832378458, "comparison_vector_value": 1, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `exact match on city` then comparison is 12.14 times more likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 3}, {"comparison_name": "city", "sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.3305190124876736, "u_probability": 0.9448524288198547, "m_probability_description": "Amongst matching record comparisons, 33.05% of records are in the all other comparisons comparison level", "u_probability_description": "Amongst non-matching record comparisons, 94.49% of records are in the all other comparisons comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 0.3498101951227458, "log2_bayes_factor": -1.5153557580615085, "comparison_vector_value": 0, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `all other comparisons` then comparison is  2.86 times less likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 3}]}}, {"mode": "vega-lite"});
</script>

<h3 id="manually-altering-m-and-u-probabilities-post-training">Manually altering <code>m</code> and <code>u</code> probabilities post-training<a class="headerlink" href="#manually-altering-m-and-u-probabilities-post-training" title="Permanent link">¶</a></h3>
<p>This is not officially supported, but can be useful for ad-hoc alterations to trained models.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_level_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cll</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span><span class="p">,</span> <span class="n">block_on</span><span class="p">,</span> <span class="n">splink_datasets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">splink_dataset_labels</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">splink_dataset_labels</span><span class="o">.</span><span class="n">fake_1000_labels</span>

<span class="n">db_api</span> <span class="o">=</span> <span class="n">DuckDBAPI</span><span class="p">()</span>


<span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"city"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">splink_datasets</span><span class="o">.</span><span class="n">fake_1000</span>
<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">db_api</span><span class="p">,</span> <span class="n">set_up_basic_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_u_using_random_sampling</span><span class="p">(</span><span class="n">max_pairs</span><span class="o">=</span><span class="mf">1e6</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span><span class="n">block_on</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">))</span>


<span class="n">surname_comparison</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_get_comparison_by_output_column_name</span><span class="p">(</span>
    <span class="s2">"surname"</span>
<span class="p">)</span>
<span class="n">else_comparison_level</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">surname_comparison</span><span class="o">.</span><span class="n">_get_comparison_level_by_comparison_vector_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">else_comparison_level</span><span class="o">.</span><span class="n">_m_probability</span> <span class="o">=</span> <span class="mf">0.1</span>


<span class="n">linker</span><span class="o">.</span><span class="n">visualisations</span><span class="o">.</span><span class="n">m_u_parameters_chart</span><span class="p">()</span>
</code></pre></div>
<style>
  #altair-viz-25439eac84d6494cbc13945e9184ca3b.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-25439eac84d6494cbc13945e9184ca3b.vega-embed details,
  #altair-viz-25439eac84d6494cbc13945e9184ca3b.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-25439eac84d6494cbc13945e9184ca3b"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-25439eac84d6494cbc13945e9184ca3b") {
      outputDiv = document.getElementById("altair-viz-25439eac84d6494cbc13945e9184ca3b");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300, "discreteHeight": 300, "discreteWidth": 400}, "header": {"title": null}, "title": {"anchor": "middle", "offset": 10}}, "hconcat": [{"mark": "bar", "encoding": {"color": {"value": "green"}, "row": {"field": "comparison_name", "header": {"labelAlign": "left", "labelAnchor": "middle", "labelAngle": 0}, "sort": {"field": "comparison_sort_order"}, "type": "nominal"}, "tooltip": [{"field": "m_probability_description", "title": "m probability description", "type": "nominal"}, {"field": "comparison_name", "title": "Comparison column name", "type": "nominal"}, {"field": "label_for_charts", "title": "Label", "type": "ordinal"}, {"field": "sql_condition", "title": "SQL condition", "type": "nominal"}, {"field": "m_probability", "format": ".4p", "title": "m probability", "type": "quantitative"}, {"field": "u_probability", "format": ".4p", "title": "u probability", "type": "quantitative"}, {"field": "bayes_factor", "format": ",.4f", "title": "Bayes factor = m/u", "type": "quantitative"}, {"field": "log2_bayes_factor", "format": ",.4f", "title": "Match weight = log2(m/u)", "type": "quantitative"}], "x": {"axis": {"title": "Proportion of record comparisons"}, "field": "m_probability", "type": "quantitative"}, "y": {"axis": {"title": null}, "field": "label_for_charts", "sort": {"field": "comparison_vector_value", "order": "descending"}, "type": "nominal"}}, "height": {"step": 12}, "resolve": {"scale": {"y": "independent"}}, "title": {"text": "Amongst matching record comparisons:", "fontSize": 12, "fontWeight": "bold"}, "transform": [{"filter": "(datum.bayes_factor != 'no-op filter due to vega lite issue 4680')"}], "width": 150}, {"mark": "bar", "encoding": {"color": {"value": "red"}, "row": {"field": "comparison_name", "header": {"labels": false}, "sort": {"field": "comparison_sort_order"}, "type": "nominal"}, "tooltip": [{"field": "u_probability_description", "title": "u probability description", "type": "nominal"}, {"field": "comparison_name", "title": "Comparison column name", "type": "nominal"}, {"field": "label_for_charts", "title": "Label", "type": "ordinal"}, {"field": "sql_condition", "title": "SQL condition", "type": "nominal"}, {"field": "m_probability", "format": ".4p", "title": "m probability", "type": "quantitative"}, {"field": "u_probability", "format": ".4p", "title": "u probability", "type": "quantitative"}, {"field": "bayes_factor", "format": ",.4f", "title": "Bayes factor = m/u", "type": "quantitative"}, {"field": "log2_bayes_factor", "format": ",.4f", "title": "Match weight = log2(m/u)", "type": "quantitative"}], "x": {"axis": {"title": "Proportion of record comparisons"}, "field": "u_probability", "type": "quantitative"}, "y": {"axis": {"title": null}, "field": "label_for_charts", "sort": {"field": "comparison_vector_value", "order": "descending"}, "type": "nominal"}}, "height": {"step": 12}, "resolve": {"scale": {"y": "independent"}}, "title": {"text": "Amongst non-matching record comparisons:", "fontSize": 12, "fontWeight": "bold"}, "transform": [{"filter": "(datum.bayes_factor != 'no-op filter2 due to vega lite issue 4680')"}], "width": 150}], "data": {"name": "data-a5733d8bc2dbab373de54debaa5e8680"}, "title": {"text": "Proportion of record comparisons in each comparison level by match status", "subtitle": "(m and u probabilities)"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.9.3.json", "datasets": {"data-a5733d8bc2dbab373de54debaa5e8680": [{"comparison_name": "first_name", "sql_condition": "\"first_name_l\" = \"first_name_r\"", "label_for_charts": "Exact match on first_name", "m_probability": 0.5197676194880654, "u_probability": 0.0057935713975033705, "m_probability_description": "Amongst matching record comparisons, 51.98% of records are in the exact match on first_name comparison level", "u_probability_description": "Amongst non-matching record comparisons, 0.58% of records are in the exact match on first_name comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 89.71454459196781, "log2_bayes_factor": 6.487269989838904, "comparison_vector_value": 1, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `exact match on first_name` then comparison is 89.71 times more likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 0}, {"comparison_name": "first_name", "sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.48023238051193456, "u_probability": 0.9942064286024966, "m_probability_description": "Amongst matching record comparisons, 48.02% of records are in the all other comparisons comparison level", "u_probability_description": "Amongst non-matching record comparisons, 99.42% of records are in the all other comparisons comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 0.4830308542532478, "log2_bayes_factor": -1.0498127487736273, "comparison_vector_value": 0, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `all other comparisons` then comparison is  2.07 times less likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 0}, {"comparison_name": "surname", "sql_condition": "\"surname_l\" = \"surname_r\"", "label_for_charts": "Exact match on surname", "m_probability": 0.46081174568408456, "u_probability": 0.004889975550122249, "m_probability_description": "Amongst matching record comparisons, 46.08% of records are in the exact match on surname comparison level", "u_probability_description": "Amongst non-matching record comparisons, 0.49% of records are in the exact match on surname comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 94.23600199239529, "log2_bayes_factor": 6.558206428324665, "comparison_vector_value": 1, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `exact match on surname` then comparison is 94.24 times more likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 1}, {"comparison_name": "surname", "sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.1, "u_probability": 0.9951100244498777, "m_probability_description": "Amongst matching record comparisons, 10.00% of records are in the all other comparisons comparison level", "u_probability_description": "Amongst non-matching record comparisons, 99.51% of records are in the all other comparisons comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 0.1004914004914005, "log2_bayes_factor": -3.3148560462118604, "comparison_vector_value": 0, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `all other comparisons` then comparison is  9.95 times less likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 1}, {"comparison_name": "dob", "sql_condition": "\"dob_l\" = \"dob_r\"", "label_for_charts": "Exact match on dob", "m_probability": 0.95, "u_probability": 0.0017477477477477479, "m_probability_description": "Amongst matching record comparisons, 95.00% of records are in the exact match on dob comparison level", "u_probability_description": "Amongst non-matching record comparisons, 0.17% of records are in the exact match on dob comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 543.5567010309278, "log2_bayes_factor": 9.086286727381289, "comparison_vector_value": 1, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `exact match on dob` then comparison is 543.56 times more likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 2}, {"comparison_name": "dob", "sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.050000000000000044, "u_probability": 0.9982522522522522, "m_probability_description": "Amongst matching record comparisons, 5.00% of records are in the all other comparisons comparison level", "u_probability_description": "Amongst non-matching record comparisons, 99.83% of records are in the all other comparisons comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 0.05008754038589973, "log2_bayes_factor": -4.319404421864071, "comparison_vector_value": 0, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `all other comparisons` then comparison is  19.97 times less likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 2}, {"comparison_name": "city", "sql_condition": "\"city_l\" = \"city_r\"", "label_for_charts": "Exact match on city", "m_probability": 0.5906525701958633, "u_probability": 0.0551475711801453, "m_probability_description": "Amongst matching record comparisons, 59.07% of records are in the exact match on city comparison level", "u_probability_description": "Amongst non-matching record comparisons, 5.51% of records are in the exact match on city comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 10.710400432077687, "log2_bayes_factor": 3.4209405143381115, "comparison_vector_value": 1, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `exact match on city` then comparison is 10.71 times more likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 3}, {"comparison_name": "city", "sql_condition": "ELSE", "label_for_charts": "All other comparisons", "m_probability": 0.4093474298041367, "u_probability": 0.9448524288198547, "m_probability_description": "Amongst matching record comparisons, 40.93% of records are in the all other comparisons comparison level", "u_probability_description": "Amongst non-matching record comparisons, 94.49% of records are in the all other comparisons comparison level", "has_tf_adjustments": false, "tf_adjustment_column": null, "tf_adjustment_weight": 1.0, "is_null_level": false, "bayes_factor": 0.43323953806778304, "log2_bayes_factor": -1.2067631834937573, "comparison_vector_value": 0, "max_comparison_vector_value": 1, "bayes_factor_description": "If comparison level is `all other comparisons` then comparison is  2.31 times less likely to be a match", "probability_two_random_records_match": 0.0001, "comparison_sort_order": 3}]}}, {"mode": "vega-lite"});
</script>

<h3 id="generate-the-beta-labelling-tool">Generate the (beta) labelling tool<a class="headerlink" href="#generate-the-beta-labelling-tool" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span><span class="p">,</span> <span class="n">block_on</span><span class="p">,</span> <span class="n">splink_datasets</span>

<span class="n">db_api</span> <span class="o">=</span> <span class="n">DuckDBAPI</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">splink_datasets</span><span class="o">.</span><span class="n">fake_1000</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"city"</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"email"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">db_api</span><span class="p">,</span> <span class="n">set_up_basic_logging</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_probability_two_random_records_match</span><span class="p">(</span>
    <span class="p">[</span><span class="n">block_on</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">,</span> <span class="s2">"surname"</span><span class="p">)],</span> <span class="n">recall</span><span class="o">=</span><span class="mf">0.7</span>
<span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_u_using_random_sampling</span><span class="p">(</span><span class="n">max_pairs</span><span class="o">=</span><span class="mf">1e6</span><span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span><span class="n">block_on</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">))</span>

<span class="n">pairwise_predictions</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">threshold_match_weight</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>

<span class="n">first_unique_id</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unique_id</span>
<span class="n">linker</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">labelling_tool_for_specific_record</span><span class="p">(</span><span class="n">unique_id</span><span class="o">=</span><span class="n">first_unique_id</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h3 id="modifying-settings-after-loading-from-a-serialised-json-model">Modifying settings after loading from a serialised <code>.json</code> model<a class="headerlink" href="#modifying-settings-after-loading-from-a-serialised-json-model" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span><span class="p">,</span> <span class="n">block_on</span><span class="p">,</span> <span class="n">splink_datasets</span>

<span class="c1"># setup to create a model</span>

<span class="n">db_api</span> <span class="o">=</span> <span class="n">DuckDBAPI</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">splink_datasets</span><span class="o">.</span><span class="n">fake_1000</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">LevenshteinAtThresholds</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">LevenshteinAtThresholds</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>

    <span class="p">],</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">,</span> <span class="s2">"dob"</span><span class="p">),</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">db_api</span><span class="p">)</span>


<span class="n">linker</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">save_model_to_json</span><span class="p">(</span><span class="s2">"mod.json"</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">new_settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="o">.</span><span class="n">from_path_or_dict</span><span class="p">(</span><span class="s2">"mod.json"</span><span class="p">)</span>

<span class="n">new_settings</span><span class="o">.</span><span class="n">retain_intermediate_calculation_columns</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">new_settings</span><span class="o">.</span><span class="n">blocking_rules_to_generate_predictions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"1=1"</span><span class="p">]</span>
<span class="n">new_settings</span><span class="o">.</span><span class="n">additional_columns_to_retain</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"cluster"</span><span class="p">]</span>

<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">new_settings</span><span class="p">,</span> <span class="n">DuckDBAPI</span><span class="p">())</span>

<span class="n">linker</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span><span class="o">.</span><span class="n">as_duckdbpyrelation</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<h3 id="using-a-duckdb-udf-in-a-comparison-level">Using a DuckDB UDF in a comparison level<a class="headerlink" href="#using-a-duckdb-udf-in-a-comparison-level" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">difflib</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">duckdb</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_level_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cll</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span><span class="p">,</span> <span class="n">block_on</span><span class="p">,</span> <span class="n">splink_datasets</span>


<span class="k">def</span><span class="w"> </span><span class="nf">custom_partial_ratio</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Custom function to compute partial ratio similarity between two strings."""</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s1</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
    <span class="n">matcher</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">SequenceMatcher</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matcher</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">splink_datasets</span><span class="o">.</span><span class="n">fake_1000</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">con</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span>
    <span class="s2">"custom_partial_ratio"</span><span class="p">,</span>
    <span class="n">custom_partial_ratio</span><span class="p">,</span>
    <span class="p">[</span><span class="n">duckdb</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">,</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">VARCHAR</span><span class="p">],</span>
    <span class="n">duckdb</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">db_api</span> <span class="o">=</span> <span class="n">DuckDBAPI</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">con</span><span class="p">)</span>


<span class="n">fuzzy_email_comparison</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"output_column_name"</span><span class="p">:</span> <span class="s2">"email_fuzzy"</span><span class="p">,</span>
    <span class="s2">"comparison_levels"</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">NullLevel</span><span class="p">(</span><span class="s2">"email"</span><span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">ExactMatchLevel</span><span class="p">(</span><span class="s2">"email"</span><span class="p">),</span>
        <span class="p">{</span>
            <span class="s2">"sql_condition"</span><span class="p">:</span> <span class="s2">"custom_partial_ratio(email_l, email_r) &gt; 0.8"</span><span class="p">,</span>
            <span class="s2">"label_for_charts"</span><span class="p">:</span> <span class="s2">"Fuzzy match (≥ 0.8)"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">ElseLevel</span><span class="p">(),</span>
    <span class="p">],</span>
<span class="p">}</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"city"</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">fuzzy_email_comparison</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">),</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"surname"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">db_api</span><span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_probability_two_random_records_match</span><span class="p">(</span>
    <span class="p">[</span><span class="n">block_on</span><span class="p">(</span><span class="s2">"first_name"</span><span class="p">,</span> <span class="s2">"surname"</span><span class="p">)],</span> <span class="n">recall</span><span class="o">=</span><span class="mf">0.7</span>
<span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_u_using_random_sampling</span><span class="p">(</span><span class="n">max_pairs</span><span class="o">=</span><span class="mf">1e5</span><span class="p">)</span>

<span class="n">linker</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span><span class="n">block_on</span><span class="p">(</span><span class="s2">"dob"</span><span class="p">))</span>

<span class="n">pairwise_predictions</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">threshold_match_weight</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<h3 id="nested-linkage">Nested linkage<a class="headerlink" href="#nested-linkage" title="Permanent link">¶</a></h3>
<p>In this example, we want to deduplicate persons but only within each company.</p>
<p>The problem is that the companies themselves may be duplicates, so we proceed by deduplicating the companies first and then deduplicating persons nested within each company we resolved in step 1.</p>
<p>Note I do not include full model training code here, just a simple/illustrative model spec.  The example is more about demonstrating the nested linkage process.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">duckdb</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span><span class="p">,</span> <span class="n">block_on</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink.clustering</span><span class="w"> </span><span class="kn">import</span> <span class="n">cluster_pairwise_predictions_at_threshold</span>

<span class="c1"># Example data with companies and persons</span>
<span class="n">company_person_records_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">1001</span><span class="p">,</span>
        <span class="s2">"client_id"</span><span class="p">:</span> <span class="s2">"GGN1"</span><span class="p">,</span>
        <span class="s2">"company_name"</span><span class="p">:</span> <span class="s2">"Green Garden Nurseries Ltd"</span><span class="p">,</span>
        <span class="s2">"postcode"</span><span class="p">:</span> <span class="s2">"NR1 1AB"</span><span class="p">,</span>
        <span class="s2">"person_firstname"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span>
        <span class="s2">"person_surname"</span><span class="p">:</span> <span class="s2">"Smith"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">1002</span><span class="p">,</span>
        <span class="s2">"client_id"</span><span class="p">:</span> <span class="s2">"GGN1"</span><span class="p">,</span>
        <span class="s2">"company_name"</span><span class="p">:</span> <span class="s2">"Green Gardens Ltd"</span><span class="p">,</span>
        <span class="s2">"postcode"</span><span class="p">:</span> <span class="s2">"NR1 1AB"</span><span class="p">,</span>
        <span class="s2">"person_firstname"</span><span class="p">:</span> <span class="s2">"Sarah"</span><span class="p">,</span>
        <span class="s2">"person_surname"</span><span class="p">:</span> <span class="s2">"Jones"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">1003</span><span class="p">,</span>
        <span class="s2">"client_id"</span><span class="p">:</span> <span class="s2">"GGN2"</span><span class="p">,</span>
        <span class="s2">"company_name"</span><span class="p">:</span> <span class="s2">"Green Garden Nurseries Ltd"</span><span class="p">,</span>
        <span class="s2">"postcode"</span><span class="p">:</span> <span class="s2">"NR1 1AB"</span><span class="p">,</span>
        <span class="s2">"person_firstname"</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span>
        <span class="s2">"person_surname"</span><span class="p">:</span> <span class="s2">"Smith"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">3001</span><span class="p">,</span>
        <span class="s2">"client_id"</span><span class="p">:</span> <span class="s2">"GW1"</span><span class="p">,</span>
        <span class="s2">"company_name"</span><span class="p">:</span> <span class="s2">"Garden World"</span><span class="p">,</span>
        <span class="s2">"postcode"</span><span class="p">:</span> <span class="s2">"LS2 3EF"</span><span class="p">,</span>
        <span class="s2">"person_firstname"</span><span class="p">:</span> <span class="s2">"Emma"</span><span class="p">,</span>
        <span class="s2">"person_surname"</span><span class="p">:</span> <span class="s2">"Wilson"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">3002</span><span class="p">,</span>
        <span class="s2">"client_id"</span><span class="p">:</span> <span class="s2">"GW1"</span><span class="p">,</span>
        <span class="s2">"company_name"</span><span class="p">:</span> <span class="s2">"Garden World UK"</span><span class="p">,</span>
        <span class="s2">"postcode"</span><span class="p">:</span> <span class="s2">"LS2 3EF"</span><span class="p">,</span>
        <span class="s2">"person_firstname"</span><span class="p">:</span> <span class="s2">"Emma"</span><span class="p">,</span>
        <span class="s2">"person_surname"</span><span class="p">:</span> <span class="s2">"Wilson"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">3003</span><span class="p">,</span>
        <span class="s2">"client_id"</span><span class="p">:</span> <span class="s2">"GW2"</span><span class="p">,</span>
        <span class="s2">"company_name"</span><span class="p">:</span> <span class="s2">"Garden World"</span><span class="p">,</span>
        <span class="s2">"postcode"</span><span class="p">:</span> <span class="s2">"LS2 3EF"</span><span class="p">,</span>
        <span class="s2">"person_firstname"</span><span class="p">:</span> <span class="s2">"Emma"</span><span class="p">,</span>
        <span class="s2">"person_surname"</span><span class="p">:</span> <span class="s2">"Wilson"</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">3004</span><span class="p">,</span>
        <span class="s2">"client_id"</span><span class="p">:</span> <span class="s2">"GW2"</span><span class="p">,</span>
        <span class="s2">"company_name"</span><span class="p">:</span> <span class="s2">"Garden World"</span><span class="p">,</span>
        <span class="s2">"postcode"</span><span class="p">:</span> <span class="s2">"LS2 3EF"</span><span class="p">,</span>
        <span class="s2">"person_firstname"</span><span class="p">:</span> <span class="s2">"James"</span><span class="p">,</span>
        <span class="s2">"person_surname"</span><span class="p">:</span> <span class="s2">"Taylor"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>
<span class="n">company_person_records</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">company_person_records_list</span><span class="p">)</span>
<span class="n">company_person_records</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"========== NESTED COMPANY-PERSON LINKAGE EXAMPLE =========="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"This example demonstrates a two-phase linkage process:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"1. First, link and cluster to find duplicate companies (client_id)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"2. Then, deduplicate persons ONLY within each company cluster"</span><span class="p">)</span>

<span class="c1"># Initialize database</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">"nested_linkage.ddb"</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">"nested_linkage.ddb"</span><span class="p">)</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">"nested_linkage.ddb"</span><span class="p">)</span>

<span class="c1"># Load data into DuckDB</span>
<span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="s2">"CREATE OR REPLACE TABLE company_person_records AS "</span>
    <span class="s2">"SELECT * FROM company_person_records"</span>
<span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- PHASE 1: COMPANY LINKAGE ---"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Company records to be linked:"</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">"company_person_records"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># STEP 1: Find duplicate client_ids</span>


<span class="c1"># Configure company linkage</span>
<span class="c1"># We match on person name because if we have duplicate client_ids,</span>
<span class="c1"># it's likely that they may share the same contact</span>
<span class="c1"># Note though, at this stage the entity is client not a person</span>
<span class="n">company_settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">unique_id_column_name</span><span class="o">=</span><span class="s2">"unique_id"</span><span class="p">,</span>
    <span class="n">probability_two_random_records_match</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"client_id"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">JaroWinklerAtThresholds</span><span class="p">(</span><span class="s2">"person_firstname"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">JaroWinklerAtThresholds</span><span class="p">(</span><span class="s2">"person_surname"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">JaroWinklerAtThresholds</span><span class="p">(</span><span class="s2">"company_name"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(</span><span class="s2">"postcode"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"postcode"</span><span class="p">),</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"company_name"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">retain_matching_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">db_api</span> <span class="o">=</span> <span class="n">DuckDBAPI</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">con</span><span class="p">)</span>
<span class="n">company_linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="s2">"company_person_records"</span><span class="p">,</span> <span class="n">company_settings</span><span class="p">,</span> <span class="n">db_api</span><span class="p">)</span>
<span class="n">company_predictions</span> <span class="o">=</span> <span class="n">company_linker</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">threshold_match_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Company pairwise matches:"</span><span class="p">)</span>
<span class="n">company_predictions</span><span class="o">.</span><span class="n">as_duckdbpyrelation</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Cluster companies</span>
<span class="n">company_nodes</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">"SELECT DISTINCT client_id FROM company_person_records"</span><span class="p">)</span>
<span class="n">company_edges</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">"""</span>
<span class="s2">    SELECT</span>
<span class="s2">        client_id_l as n_1,</span>
<span class="s2">        client_id_r as n_2,</span>
<span class="s2">        match_probability</span>
<span class="s2">    FROM </span><span class="si">{</span><span class="n">company_predictions</span><span class="o">.</span><span class="n">physical_name</span><span class="si">}</span>
<span class="s2">"""</span><span class="p">)</span>

<span class="c1"># Perform company clustering</span>
<span class="n">company_clusters</span> <span class="o">=</span> <span class="n">cluster_pairwise_predictions_at_threshold</span><span class="p">(</span>
    <span class="n">company_nodes</span><span class="p">,</span>
    <span class="n">company_edges</span><span class="p">,</span>
    <span class="n">node_id_column_name</span><span class="o">=</span><span class="s2">"client_id"</span><span class="p">,</span>
    <span class="n">edge_id_column_name_left</span><span class="o">=</span><span class="s2">"n_1"</span><span class="p">,</span>
    <span class="n">edge_id_column_name_right</span><span class="o">=</span><span class="s2">"n_2"</span><span class="p">,</span>
    <span class="n">db_api</span><span class="o">=</span><span class="n">db_api</span><span class="p">,</span>
    <span class="n">threshold_match_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add company cluster IDs to original records</span>
<span class="n">company_clusters_ddb</span> <span class="o">=</span> <span class="n">company_clusters</span><span class="o">.</span><span class="n">as_duckdbpyrelation</span><span class="p">()</span>
<span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">"company_clusters_ddb"</span><span class="p">,</span> <span class="n">company_clusters_ddb</span><span class="p">)</span>


<span class="n">sql</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">CREATE TABLE records_with_company_cluster AS</span>
<span class="s2">SELECT cr.*,</span>
<span class="s2">       cc.cluster_id as company_cluster_id</span>
<span class="s2">FROM company_person_records cr</span>
<span class="s2">LEFT JOIN company_clusters_ddb cc</span>
<span class="s2">ON cr.client_id = cc.client_id</span>
<span class="s2">"""</span>
<span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Records with company cluster:"</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">"records_with_company_cluster"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Not needed, just to see what's happening</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Company clustering results:"</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">"""</span>
<span class="s2">SELECT</span>
<span class="s2">    company_cluster_id,</span>
<span class="s2">    array_agg(DISTINCT client_id) as client_ids,</span>
<span class="s2">    array_agg(DISTINCT company_name) as company_names</span>
<span class="s2">FROM records_with_company_cluster</span>
<span class="s2">GROUP BY company_cluster_id</span>
<span class="s2">"""</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- PHASE 2: PERSON LINKAGE WITHIN COMPANIES ---"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Now linking persons, but only within their company clusters"</span><span class="p">)</span>

<span class="c1"># STEP 2: Link persons within company clusters</span>
<span class="c1"># Create a new connection to isolate this step</span>
<span class="n">con2</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">con2</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">"attach 'nested_linkage.ddb' as linkage_db"</span><span class="p">)</span>
<span class="n">con2</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="s2">"create table records_with_company_cluster as select * from linkage_db.records_with_company_cluster"</span>
<span class="p">)</span>
<span class="n">db_api2</span> <span class="o">=</span> <span class="n">DuckDBAPI</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">con2</span><span class="p">)</span>

<span class="c1"># Configure person linkage within company clusters</span>
<span class="c1"># Simple linking model just distinguishes between people within a client_id</span>
<span class="c1"># There shouldn't be many so this model can be straightforward</span>
<span class="n">person_settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"dedupe_only"</span><span class="p">,</span>
    <span class="n">probability_two_random_records_match</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">JaroWinklerAtThresholds</span><span class="p">(</span><span class="s2">"person_firstname"</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">JaroWinklerAtThresholds</span><span class="p">(</span><span class="s2">"person_surname"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># Critical: Block on company_cluster_id to only compare within company</span>
        <span class="n">block_on</span><span class="p">(</span><span class="s2">"company_cluster_id"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">retain_matching_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Link persons within company clusters</span>
<span class="n">person_linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span><span class="s2">"records_with_company_cluster"</span><span class="p">,</span> <span class="n">person_settings</span><span class="p">,</span> <span class="n">db_api2</span><span class="p">)</span>
<span class="n">person_predictions</span> <span class="o">=</span> <span class="n">person_linker</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">threshold_match_probability</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Person pairwise matches (within company clusters):"</span><span class="p">)</span>
<span class="n">person_predictions</span><span class="o">.</span><span class="n">as_duckdbpyrelation</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">max_width</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">person_clusters</span> <span class="o">=</span> <span class="n">person_linker</span><span class="o">.</span><span class="n">clustering</span><span class="o">.</span><span class="n">cluster_pairwise_predictions_at_threshold</span><span class="p">(</span>
    <span class="n">person_predictions</span><span class="p">,</span> <span class="n">threshold_match_probability</span><span class="o">=</span><span class="mf">0.5</span>
<span class="p">)</span>

<span class="n">person_clusters</span><span class="o">.</span><span class="n">as_duckdbpyrelation</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">"cluster_id"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">max_width</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</code></pre></div>
<h2 id="comparing-a-list-of-values-with-fuzzy-matching-and-term-frequency-adjustments">Comparing a list of values with fuzzy matching and term frequency adjustments<a class="headerlink" href="#comparing-a-list-of-values-with-fuzzy-matching-and-term-frequency-adjustments" title="Permanent link">¶</a></h2>
<p>See <a href="https://github.com/moj-analytical-services/splink/discussions/2721">here</a> for a description of this approach</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">duckdb</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_level_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cll</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">splink.comparison_library</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">splink</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBAPI</span><span class="p">,</span> <span class="n">Linker</span><span class="p">,</span> <span class="n">SettingsCreator</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s2">":memory:"</span><span class="p">)</span>

<span class="n">left_records</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"primary_forename"</span><span class="p">:</span> <span class="s2">"Alisha"</span><span class="p">,</span>
        <span class="s2">"all_forenames"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Alisha"</span><span class="p">,</span> <span class="s2">"Alisha Louise"</span><span class="p">,</span> <span class="s2">"Ali"</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">"primary_forename"</span><span class="p">:</span> <span class="s2">"Michael"</span><span class="p">,</span>
        <span class="s2">"all_forenames"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Michael"</span><span class="p">,</span> <span class="s2">"Mike"</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">right_records</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"primary_forename"</span><span class="p">:</span> <span class="s2">"Alisha"</span><span class="p">,</span> <span class="s2">"all_forenames"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Alisha"</span><span class="p">,</span> <span class="s2">"Ali"</span><span class="p">]},</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">"primary_forename"</span><span class="p">:</span> <span class="s2">"Alysha"</span><span class="p">,</span> <span class="s2">"all_forenames"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Alysha"</span><span class="p">]},</span>
    <span class="p">{</span><span class="s2">"unique_id"</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">"primary_forename"</span><span class="p">:</span> <span class="s2">"Michelle"</span><span class="p">,</span> <span class="s2">"all_forenames"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Michelle"</span><span class="p">]},</span>
<span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">make_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">recs</span><span class="p">):</span>
    <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">"drop table if exists </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"""</span>
<span class="s2">        create table </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span>
<span class="s2">            unique_id integer,</span>
<span class="s2">            primary_forename varchar,</span>
<span class="s2">            all_forenames varchar[]</span>
<span class="s2">        )</span>
<span class="s2">    """</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recs</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="s2">"["</span> <span class="o">+</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">"'</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">'"</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">"all_forenames"</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"]"</span>
        <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"""</span>
<span class="s2">            insert into </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> values</span>
<span class="s2">                (</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s2">"unique_id"</span><span class="p">]</span><span class="si">}</span><span class="s2">, '</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="s2">"primary_forename"</span><span class="p">]</span><span class="si">}</span><span class="s2">', </span><span class="si">{</span><span class="n">arr</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        """</span>
        <span class="p">)</span>


<span class="n">make_table</span><span class="p">(</span><span class="s2">"df_left"</span><span class="p">,</span> <span class="n">left_records</span><span class="p">)</span>
<span class="n">make_table</span><span class="p">(</span><span class="s2">"df_right"</span><span class="p">,</span> <span class="n">right_records</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">"df_left"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">"df_right"</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">forename_comparison</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">CustomComparison</span><span class="p">(</span>
    <span class="n">output_column_name</span><span class="o">=</span><span class="s2">"forename"</span><span class="p">,</span>
    <span class="n">comparison_levels</span><span class="o">=</span><span class="p">[</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">NullLevel</span><span class="p">(</span><span class="s2">"primary_forename"</span><span class="p">),</span>
        <span class="c1"># 1. exact with term-frequency adjustment</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">ExactMatchLevel</span><span class="p">(</span><span class="s2">"primary_forename"</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="c1"># 2. any overlap between arrays</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">ArrayIntersectLevel</span><span class="p">(</span><span class="s2">"all_forenames"</span><span class="p">,</span> <span class="n">min_intersection</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="c1"># 3. tight fuzzy</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">JaroWinklerLevel</span><span class="p">(</span><span class="s2">"primary_forename"</span><span class="p">,</span> <span class="n">distance_threshold</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span>
        <span class="c1"># 4. looser fuzzy</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">JaroWinklerLevel</span><span class="p">(</span><span class="s2">"primary_forename"</span><span class="p">,</span> <span class="n">distance_threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span>
        <span class="c1"># 5. fuzzy anywhere in arrays</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">PairwiseStringDistanceFunctionLevel</span><span class="p">(</span>
            <span class="n">col_name</span><span class="o">=</span><span class="s2">"all_forenames"</span><span class="p">,</span>
            <span class="n">distance_function_name</span><span class="o">=</span><span class="s2">"jaro_winkler"</span><span class="p">,</span>
            <span class="n">distance_threshold</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">ElseLevel</span><span class="p">(),</span>
    <span class="p">],</span>
    <span class="n">comparison_description</span><span class="o">=</span><span class="s2">"Forename comparison combining exact, array overlap and fuzzy logic"</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsCreator</span><span class="p">(</span>
    <span class="n">link_type</span><span class="o">=</span><span class="s2">"link_only"</span><span class="p">,</span>
    <span class="n">unique_id_column_name</span><span class="o">=</span><span class="s2">"unique_id"</span><span class="p">,</span>
    <span class="n">blocking_rules_to_generate_predictions</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># create all comparisons for demo</span>
        <span class="s2">"1=1"</span>
    <span class="p">],</span>
    <span class="n">comparisons</span><span class="o">=</span><span class="p">[</span><span class="n">forename_comparison</span><span class="p">],</span>
    <span class="n">retain_intermediate_calculation_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">retain_matching_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">linker</span> <span class="o">=</span> <span class="n">Linker</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">"df_left"</span><span class="p">,</span> <span class="s2">"df_right"</span><span class="p">],</span>
    <span class="n">settings</span><span class="p">,</span>
    <span class="n">db_api</span><span class="o">=</span><span class="n">DuckDBAPI</span><span class="p">(</span><span class="n">con</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Skip training for demo purposes, just demonstrate that predict() works</span>

<span class="n">df_predict</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">df_predict</span><span class="o">.</span><span class="n">as_duckdbpyrelation</span><span class="p">()</span>
</code></pre></div></div>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../duckdb/febrl4.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Febrl4 link-only">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Febrl4 link-only
              </div>
            </div>
          </a>
        
        
          
          <a href="bias_eval.html" class="md-footer__link md-footer__link--next" aria-label="Next: Investigating Bias in a Splink Model">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Investigating Bias in a Splink Model
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/moj-analytical-services/splink" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/splink/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.robinlinacre.com/" target="_blank" rel="noopener" title="www.robinlinacre.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://moj-analytical-services.github.io/splink/feed_rss_created.xml" target="_blank" rel="noopener" title="moj-analytical-services.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64zm0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0zm32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "header.autohide", "search.highlight", "search.share", "search.suggest", "navigation.indexes", "navigation.footer", "content.action.edit", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "toc.follow"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../../../js/mkdocs-charts-plugin.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
      
    
  </body>
</html>