{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "background": "white",
  "padding": 5,
  "width": 450,
  "title": {
    "text": "Count of Additional Comparisons Generated by Each Blocking Rule",
    "subtitle": "(Counts exclude comparisons already generated by previous rules)",
    "frame": "group"
  },
  "style": "cell",
  "data": [
    {
      "name": "data-75d04db0f4c0716967a977404e6a2d09",
      "values": [
        {
          "blocking_rule": "l.\"first_name\" = r.\"first_name\"",
          "row_count": 1998,
          "cumulative_rows": 1998,
          "cartesian": 499500,
          "match_key": "0",
          "start": 0
        },
        {
          "blocking_rule": "l.\"surname\" = r.\"surname\"",
          "row_count": 1351,
          "cumulative_rows": 3349,
          "cartesian": 499500,
          "match_key": "1",
          "start": 1998
        },
        {
          "blocking_rule": "l.\"email\" = r.\"email\"",
          "row_count": 315,
          "cumulative_rows": 3664,
          "cartesian": 499500,
          "match_key": "2",
          "start": 3349
        }
      ]
    },
    {
      "name": "data_0",
      "source": "data-75d04db0f4c0716967a977404e6a2d09",
      "transform": [
        {
          "type": "formula",
          "expr": "datum[\"blocking_rule\"]===\"-x2\" ? 0 : 1",
          "as": "y_blocking_rule_sort_index"
        }
      ]
    },
    {
      "name": "data_1",
      "source": "data_0",
      "transform": [
        {
          "type": "filter",
          "expr": "isValid(datum[\"start\"]) && isFinite(+datum[\"start\"])"
        }
      ]
    }
  ],
  "signals": [
    {"name": "y_step", "value": 20},
    {
      "name": "height",
      "update": "bandspace(domain('y').length, 0.1, 0.05) * y_step"
    }
  ],
  "marks": [
    {
      "name": "marks",
      "type": "rect",
      "style": ["bar"],
      "sort": {"field": ["datum[\"cumulative_rows\"]"], "order": ["ascending"]},
      "from": {"data": "data_1"},
      "encode": {
        "update": {
          "fill": {"value": "#4c78a8"},
          "tooltip": {
            "signal": "{\"SQL Condition\": isValid(datum[\"blocking_rule\"]) ? datum[\"blocking_rule\"] : \"\"+datum[\"blocking_rule\"], \"Comparisons Generated\": format(datum[\"row_count\"], \",\"), \"Cumulative Comparisons\": format(datum[\"cumulative_rows\"], \",\"), \"Total comparisons in Cartesian product\": format(datum[\"cartesian\"], \",\")}"
          },
          "ariaRoleDescription": {"value": "bar"},
          "description": {
            "signal": "\"Comparisons Generated by Rule(s): \" + (format(datum[\"start\"], \"\")) + \"; SQL Blocking Rule: \" + (isValid(datum[\"blocking_rule\"]) ? datum[\"blocking_rule\"] : \"\"+datum[\"blocking_rule\"]) + \"; cumulative_rows: \" + (format(datum[\"cumulative_rows\"], \"\")) + \"; SQL Condition: \" + (isValid(datum[\"blocking_rule\"]) ? datum[\"blocking_rule\"] : \"\"+datum[\"blocking_rule\"]) + \"; Comparisons Generated: \" + (format(datum[\"row_count\"], \",\")) + \"; Cumulative Comparisons: \" + (format(datum[\"cumulative_rows\"], \",\")) + \"; Total comparisons in Cartesian product: \" + (format(datum[\"cartesian\"], \",\"))"
          },
          "x": {"scale": "x", "field": "start"},
          "x2": {"scale": "x", "field": "cumulative_rows"},
          "y": {"scale": "y", "field": "blocking_rule"},
          "height": {"signal": "max(0.25, bandwidth('y'))"}
        }
      }
    }
  ],
  "scales": [
    {
      "name": "x",
      "type": "linear",
      "domain": {"data": "data_1", "fields": ["start", "cumulative_rows"]},
      "range": [0, {"signal": "width"}],
      "nice": true,
      "zero": true
    },
    {
      "name": "y",
      "type": "band",
      "domain": {
        "data": "data_0",
        "field": "blocking_rule",
        "sort": {"op": "min", "field": "y_blocking_rule_sort_index"}
      },
      "range": {"step": {"signal": "y_step"}},
      "paddingInner": 0.1,
      "paddingOuter": 0.05
    }
  ],
  "axes": [
    {
      "scale": "x",
      "orient": "bottom",
      "gridScale": "y",
      "grid": true,
      "tickCount": {"signal": "ceil(width/40)"},
      "domain": false,
      "labels": false,
      "aria": false,
      "maxExtent": 0,
      "minExtent": 0,
      "ticks": false,
      "zindex": 0
    },
    {
      "scale": "x",
      "orient": "bottom",
      "grid": false,
      "title": "Comparisons Generated by Rule(s)",
      "labelFlush": true,
      "labelOverlap": true,
      "tickCount": {"signal": "ceil(width/40)"},
      "zindex": 0
    },
    {
      "scale": "y",
      "orient": "left",
      "grid": false,
      "title": "SQL Blocking Rule",
      "zindex": 0
    }
  ]
}
